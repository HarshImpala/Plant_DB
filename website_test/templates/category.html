{% extends "base.html" %}

{% block title %}{{ category.name }} - Plant Encyclopedia{% endblock %}

{% block content %}
<div class="category-page">
    <nav class="breadcrumb">
        <a href="{{ base_url }}/index.html">Home</a> &rsaquo;
        <a href="{{ base_url }}/{{ category_type_plural }}.html">{{ category_type_title }}</a> &rsaquo;
        <span>{{ category.name }}</span>
    </nav>

    <h1>{{ category.name }}</h1>
    <p class="category-meta">{{ category_type_title }}: {{ plants | length }} plant{% if plants | length != 1 %}s{% endif %}</p>

    {% if category.description %}
    <p class="category-description">{{ category.description }}</p>
    {% endif %}

    <div class="sort-bar">
        <span class="sort-label">Sort by:</span>
        <button class="sort-btn active" data-sort="scientific">Scientific name</button>
        <button class="sort-btn" data-sort="common">Common name</button>
    </div>

    <div class="plant-list-grid">
        {% for plant in plants %}
        <a href="{{ base_url }}/plant/{{ plant.slug }}.html" class="plant-list-item">
            <div class="plant-list-image">
                {% if plant.image_filename %}
                <img src="{{ base_url }}/static/images/plants/{{ plant.image_filename }}" alt="{{ plant.canonical_name }}" loading="lazy">
                {% else %}
                <div class="placeholder-image"></div>
                {% endif %}
            </div>
            <div class="plant-list-info">
                <h3>{{ plant.canonical_name or plant.scientific_name }}</h3>
                {% if plant.common_name %}
                <p>{{ plant.common_name }}</p>
                {% endif %}
            </div>
        </a>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
(function() {
    const grid = document.querySelector('.plant-list-grid');
    const buttons = document.querySelectorAll('.sort-btn');
    if (!grid) return;

    function sortGrid(by) {
        const items = Array.from(grid.querySelectorAll('.plant-list-item'));
        items.sort(function(a, b) {
            let valA, valB;
            if (by === 'common') {
                valA = (a.querySelector('p')?.textContent || '').trim().toLowerCase();
                valB = (b.querySelector('p')?.textContent || '').trim().toLowerCase();
                if (!valA && !valB) return 0;
                if (!valA) return 1;
                if (!valB) return -1;
            } else {
                valA = (a.querySelector('h3')?.textContent || '').trim().toLowerCase();
                valB = (b.querySelector('h3')?.textContent || '').trim().toLowerCase();
            }
            return valA.localeCompare(valB);
        });
        items.forEach(function(item) { grid.appendChild(item); });
    }

    buttons.forEach(function(btn) {
        btn.addEventListener('click', function() {
            buttons.forEach(function(b) { b.classList.remove('active'); });
            btn.classList.add('active');
            sortGrid(btn.dataset.sort);
        });
    });
})();
</script>
{% endblock %}
